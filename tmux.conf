# =========================
# --- Plugins (TPM) at top ---
# =========================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'omerxx/tmux-floax'
set -g @plugin 'joshmedeski/t-smart-tmux-session-manager'
set -g @plugin 'tmux-plugins/tmux-urlview'

# =========================
# --- Source & Truecolor ---
# =========================
set-option -g default-terminal "screen-256color"
set-option -g terminal-overrides ",*:RGB"

# =========================
# --- Prefix & Basics ---
# =========================
unbind C-b
set -g prefix C-a
bind C-a send-prefix
set -g base-index 1
set -g pane-base-index 1
set -g escape-time 0
set -g history-limit 1000000
set -g mouse on
set -g set-clipboard on
set -g renumber-windows on
set -g repeat-time 1000
set -g visual-bell off
set -g bell-action none
set -g set-clipboard on
setw -g mode-keys vi

# =========================
# --- Appearance (Minimalistic) ---
# =========================
set -g status-position bottom
set -g status on
set -g status-interval 5
set -g status-style "bg=default,fg=brightblack"
set -g status-left-length 200
set -g status-right-length 200
set -g status-justify centre

set -g pane-border-lines single
set -g pane-border-style "fg=brightblack,bg=default"
set -g pane-active-border-style "fg=cyan,bg=default"
set -g message-style "bg=default,fg=cyan,bold"
set -g message-command-style "bg=default,fg=green,bold"
set -g pane-border-format ""

# =========================
# --- Keybindings ---
# =========================
# Navigation
bind w select-pane -U
bind a select-pane -L
bind s select-pane -D
bind d select-pane -R

# Resize
bind -r W resize-pane -U 2
bind -r A resize-pane -L 2
bind -r S resize-pane -D 2
bind -r D resize-pane -R 2

# Alt Navigation
bind -n M-w select-pane -U
bind -n M-a select-pane -L
bind -n M-s select-pane -D
bind -n M-d select-pane -R
bind -n M-f resize-pane -Z

# Splits
bind h split-window -h
bind | split-window -h
bind v split-window -v
bind - split-window -v

# Window control
bind -n M-n next-window
bind -n M-p previous-window

# Misc
bind q detach-client
bind e choose-window -Z

# kill window session
bind K confirm-before -p "Kill current session #S? (y/n)" kill-session
bind k confirm-before -p "Kill current window #W? (y/n)" kill-window


 

# =========================
# --- Plugin Configs ---
# =========================
set -g @floax-width '80%'
set -g @floax-height '80%'
set -g @floax-border-color 'magenta'
set -g @floax-text-color 'blue'
set -g @floax-bind 'p'
set -g @sessionx-bind 'o'
set -g @sessionx-zoxide-mode 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'
set -g @resurrect-strategy-nvim 'session'
set -g @fzf-url-fzf-options '-p 60%,30% --prompt=" " --border-label=" Open URL "'

# =========================
# --- Productivity Enhancements ---
# =========================
# Auto-rename windows
setw -g automatic-rename on
setw -g automatic-rename-format "#{b:pane_current_command}"

# Monitor activity & visual alerts
setw -g monitor-activity on
set -g visual-activity on

# Prefix highlight improvements
set -g @prefix_highlight_fg "black"
set -g @prefix_highlight_bg "yellow"
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'

# Session switcher
bind -n M-o run-shell "tmux list-sessions -F '#S' | fzf | xargs tmux switch-client -t"

# Quick info popup
bind i display-popup -E "tmux list-sessions && echo && tmux list-windows && echo && tmux list-panes -a"

# Vi-copy mode: copy to clipboard
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

# File finder popup
bind f display-popup -w 100% -h 75% -E "bash ~/.config/tmux/file_finder_ranger.sh"

# Generic shell popup
bind C-t display-popup \
    -d "#{pane_current_path}" \
    -w 70% \
    -h 70% \
    -E "bash"

# =========================
# --- Session & Window Popups ---
# =========================
bind C-s display-popup -E 'bash -c "read -p \"Session name: \" name; tmux new-session -d -s \$name && tmux switch-client -t \$name"'
bind C-w display-popup -E 'bash -c "read -p \"Window name: \" name; tmux new-window -d -n \$name && tmux select-window -t \$name"'
bind C-y display-popup -d "#{pane_current_path}" -w 80% -h 80% -E "lazygit"

# =========================
# --- New Improvements ---
# =========================
bind b select-layout tiled
bind C-i display-popup -w 90% -h 90% -E "btop"

# Yank entire buffer to system clipboard (fixed)
bind Y run-shell "tmux save-buffer - | xclip -in -selection clipboard"


# =========================
# --- Normal Copy / Paste ---
# =========================
# Enter copy mode with Ctrl+C
bind C-c copy-mode

# In copy mode: copy selection to system clipboard with Ctrl+C
bind -T copy-mode-vi C-c send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

# Paste from system clipboard with Ctrl+V
bind C-v run-shell "xclip -o -selection clipboard | tmux load-buffer - && tmux paste-buffer"







# Direct window switch keys (Alt+1..9)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# =========================
# --- TPM Keybinds ---
# =========================
bind i run '~/.config/tmux/plugins/tpm/bin/install_plugins'
bind u run '~/.config/tmux/plugins/tpm/bin/update_plugins all'
bind C run '~/.config/tmux/plugins/tpm/bin/clean_plugins'
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!" \; run-shell -b 'sleep 1 && tmux refresh-client -S'





# =========================
# --- Status Bar Content ---
# =========================

# General status bar settings
set -g status on
set -g status-justify centre
set -g status-bg default
set -g status-fg white
set -g status-left-length 60
set -g status-right-length 30

# Left: Current directory (bold cyan) with subtle separator
set -g status-left "#[bold,fg=cyan] #{pane_current_path} #[fg=brightblack]|"

# Right: Session name (bold green) with separator
set -g status-right "#[fg=brightblack]| #[bold,fg=green] #S "

# Middle: Windows (centered), gradient colors for inactive windows, active window highlighted
# Helper: We'll use bright colors for gradient simulation
set -g window-status-format "#[fg=colour244]#W "
set -g window-status-current-format "#[bold,fg=white,bg=blue] #W "

# Separator between windows
set -g window-status-separator "#[fg=brightblack]|"

# Optional: truncate long window names dynamically
set -g status-left-length 40
set -g status-right-length 30



# =========================
# --- Live Dashboard ---
# =========================
bind d split-window -h "watch -n 3 'tmux list-sessions -F \"#{session_name}\" | while read s; do echo \"Session: \$s\"; tmux list-windows -t \$s -F \" Window: #I:#W\" | while read w; do id=\$(echo \$w | cut -d: -f1 | tr -d \" \"); echo \"\$w\"; tmux list-panes -t \$s:\$id -F \" Pane: #P - #{pane_current_command}\"; done; done'"

# =========================
# --- TPM Init ---
# =========================
run '~/.config/tmux/plugins/tpm/tpm'
run-shell "~/.config/tmux/plugins/tmux-urlview/urlview.tmux"






  ---------------

  #!/usr/bin/env bash
set -euo pipefail

SEARCH_ROOT="${1:-$HOME}"

if [[ "$SEARCH_ROOT" == "all" ]]; then
    echo "⚠️ Searching full system..."
    sleep 1
    SEARCH_ROOT="/"
fi

# Use fd if available
if command -v fd >/dev/null 2>&1; then
    SEARCH_CMD="fd --type f --type d --hidden --follow --exclude .git . \"$SEARCH_ROOT\""
else
    SEARCH_CMD="find \"$SEARCH_ROOT\" -xdev -type f -o -type d 2>/dev/null"
fi

# --- CACHE SEARCH RESULTS FOR SPEED ---
TMP_CACHE=$(mktemp)
eval "$SEARCH_CMD" > "$TMP_CACHE"

# --- FZF WITH METADATA PREVIEW ---
file=$(cat "$TMP_CACHE" | fzf \
    --height=100% \
    --border=rounded \
    --layout=reverse \
    --ansi \
    --prompt='▶ Search → ' \
    --preview 'stat {} 2>/dev/null || ls -ld {}' \
    --preview-window=right:50%:wrap \
    --bind "ctrl-r:reload:cat $TMP_CACHE"
)

[[ -z "${file:-}" ]] && exit 0




  ------------------

# --- OPEN RANGER ---
tmux new-window -n "Ranger" "cd '$(dirname "$file")' && ranger --selectfile='$(realpath "$file")'"

#!/usr/bin/env bash
set -euo pipefail

file="$1"
abs_path=$(realpath "$file")
dir_path=$(dirname "$abs_path")

# Open tmux popup and launch ranger
tmux display-popup -w 90% -h 85% -E "
cd '$dir_path' || exit
ranger --selectfile='$abs_path'
"
